let Url = window.location.origin + "/AdminBCDH/ProcessPageBanner";
let UrlUploadSilderImage = Url + "/UploadPageBanner/";
var $ = jQuery.noConflict();
let Status = [{ Value: 'true', Text: "Hoạt động" }, { Value: 'false', Text: "Tạm ngưng" }];
let TitleFor = [{ Value: 'PageBannerForLogin', Text: "Silder cho đăng nhập" }, { Value: 'PageBannerForRg', Text: "Silder cho đăng kí" }, { Value: 'PageBannerForProduct', Text: "Silder cho product" }, { Value: 'PageBannerCart', Text: "Silder cho giỏ hàng" }, { Value: 'PageBannerCheckOut', Text: "Silder cho đăng kí" }, { Value: 'PageBannerPaymentresult', Text: "Silder cho thanh toán" }, { Value: 'PageBannerHeroSection', Text: "Slider dành cho phần quảng cáo đầu" }]

var ordersStore = new DevExpress.data.CustomStore({
    key: "SliderID",
    load: function () {
        return sendRequest(Url + "/PageBanners", "GET");
    },
    insert: function (values) {
        return sendRequest(Url + "/AddPageBanner", "POST", {
            values: JSON.stringify(values)
        });
    },
    update: function (key, values) {
        return sendRequest(Url + "/EditPageBanner", "POST", {
            key: key,
            values: JSON.stringify(values)
        });
    },
    remove: function (key) {
        return sendRequest(Url + "/DeletePageBanner", "POST", {
            key: key
        });
    }
});
function sendRequest(url, method, data) {
    var d = $.Deferred();
    method = method || "GET";
    $.ajax(url, {
        method: method || "GET",
        data: data,
        cache: false,
        xhrFields: { withCredentials: true }
    }).done(function (result) {
        d.resolve(method === "GET" ? result.data : result);
    }).fail(function (xhr) {
        d.reject(xhr.responseJSON ? xhr.responseJSON.Message : xhr.statusText);
    });
    return d.promise();
}

$("#pagebanner").dxDataGrid({
    dataSource: ordersStore,
    repaintChangesOnly: true,
    showBorders: true,
    editing: {
        refreshMode: "full",
        mode: "popup",
        allowAdding: true,
        allowUpdating: true,
        allowDeleting: true,
        texts: {
            confirmDeleteMessage: "Muốn xóa chứ ?",
            deleteRow: "Xóa",
            editRow: "Sửa",
            cancelRowChanges: "Hủy",
            saveRowChanges: "Lưu"
        },
        popup: {
            title: "Chỉnh sửa và thêm mới danh mục sản phẩm",
            showTitle: true,
            width: 1500,
            height: 1000,
            position: {
                my: "top",
                at: "top",
                of: window
            }
        },
        form: {
            items: [{
                itemType: "group",
                colCount: 2,
                colSpan: 2,
                items: ["SliderID", "NameSlider", "Title", "Status", "Img"]
            }
            ]
        }
    },
    scrolling: {
        mode: "virtual"
    },
    columnsAutoWidth: true,
    showBorders: true,
    filterRow: {
        visible: true,
        applyFilter: "auto"
    },
    searchPanel: {
        visible: true,
        width: 240,
        placeholder: "Tìm kiếm..."
    },
    headerFilter: {
        visible: true
    },
    columns: [
        {

            dataField: "SliderID",
            caption: "Mã slider",
            allowEditing: false,
        },
        {
            dataField: "NameSlider",
            caption: "Nội Dung Slider",
            editCellTemplate: function (container, cellInfo) {
                var $ac = $("<div>").dxHtmlEditor({
                    toolbar: {
                        items: [
                            "undo", "redo", "separator",
                            {
                                formatName: "size",
                                formatValues: ["8pt", "10pt", "12pt", "14pt", "18pt", "24pt", "36pt"]
                            },
                            {
                                formatName: "font",
                                formatValues: ["Arial", "Courier New", "Georgia", "Impact", "Lucida Console", "Tahoma", "Times New Roman", "Verdana"]
                            },
                            "separator", "bold", "italic", "strike", "underline", "separator",
                            "alignLeft", "alignCenter", "alignRight", "alignJustify", "separator",
                            {
                                formatName: "header",
                                formatValues: [false, 1, 2, 3, 4, 5]
                            }, "separator",
                            "orderedList", "bulletList", "separator",
                            "color", "background", "separator",
                            "link", "image", "separator",
                            "clear", "codeBlock", "blockquote"
                        ]
                    },
                    mediaResizing: {
                        enabled: true
                    },
                    onValueChanged: function (e) {
                        cellInfo.setValue(e.component.option("value"));
                       
                    }

                });
                $ac.appendTo(container);
            },
            validationRules: [{ type: "required" }]
        }
        ,
        {

            dataField: "Title",
            caption: "Chủ đề slider",
            lookup: {
                dataSource: TitleFor,
                onValueChanged: function (e) {
                    cellInfo.setValue(e.component.option('selectedItem'));
                },
                valueExpr: "Value",
                displayExpr: "Text"
            }
        },
        {

            dataField: "Status",
            caption: "Trạng thái",
            lookup: {
                dataSource: Status,
                valueExpr: "Value",
                displayExpr: "Text",
                paginate: true
            },
            validationRules: [{
                type: "required",
                message: "Không được để trống"
            }
            ]
        },
        {

            dataField: "Img",
            caption: "Hình ảnh",
            editCellTemplate: function (container, cellInfo) {
                var $ac = $("<div>").dxFileUploader({
                    multiple: true,
                    //uploadMode: "useForm",
                    uploadMode: "useButtons",
                    uploadUrl: UrlUploadSilderImage + cellInfo.data.SliderID,
                    allowedFileExtensions: [".jpg", ".jpeg", ".gif", ".png"],
                    name: "ImageSilder",
                    uploadMethod: "POST",
                    labelText: "hoặc kéo thả!",
                    invalidFileExtensionMessage: "Phải không đúng định dạng!",
                    uploadFailedMessage: "Tải lên thất bại!",
                    uploadButtonText: "Tải lên",
                    uploadedMessage: "Tải lên thành công!",
                    readyToUploadMessage: "Sẵn sàng tải lên!",
                    selectButtonText: "Chọn file",
                    onValueChanged: function (e) {
                        $.each(e.value, function (index, val) {
                            cellInfo.setValue(val.name);
                        });

                    }
                });
                $ac.appendTo(container);
            },
            cellTemplate: function (container, options) {
                $("<div>")
                    .append($("<img>", { "src": "/Content/ImageUploaded/ImageBanner/" + options.value }))
                    .appendTo(container);
            }
        },
    ]
}).dxDataGrid("instance");

