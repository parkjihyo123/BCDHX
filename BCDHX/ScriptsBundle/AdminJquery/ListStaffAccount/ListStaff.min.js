var $ = jQuery.noConflict(), Url = window.location.origin + "/AdminBCDH/ProcessGetResources", UrlUploadImage = window.location.origin + "/Upload", ordersStore = new DevExpress.data.CustomStore({ key: "ID_AdminUser", load: function () { return sendRequest(Url + "/GetListStaffAccount", "POST") }, insert: function (e) { return sendRequest(Url + "/AddStaffAccount", "POST", { values: JSON.stringify(e) }) }, update: function (e, t) { return sendRequest(Url + "/UpdateStaffAccount", "POST", { key: e, values: JSON.stringify(t) }) }, remove: function (e) { return sendRequest(Url + "/RemoveStaffAccount", "POST", { key: e }) } }); function sendRequest(e, t, a) { var n = $.Deferred(); return t = t || "GET", $.ajax(e, { method: t || "GET", data: a, cache: !1, xhrFields: { withCredentials: !0 } }).done(function (e) { n.resolve("GET" === t ? e.data : e) }).fail(function (e) { n.reject(e.responseJSON ? e.responseJSON.Message : e.statusText) }), n.promise() } function validateAccountExist(e) { var t = { ID_AdminUser: e.data.ID_AdminUser, UserName: e.data.UserName }; return $.ajax({ url: Url + "/IsExsitAccount", method: "POST", data: JSON.stringify(t), contentType: "application/json; charset=utf-8", success: function (t) { e.rule.isValid = t.Result, e.rule.message = t.Message, e.validator.validate() } }), !1 } function logRequest(e, t, a) { var n = Object.keys(a || {}).map(function (e) { return e + "=" + a[e] }).join(" "), o = $("#requests ul"), i = DevExpress.localization.formatDate(new Date, "HH:mm:ss"), l = $("<li>").text([i, e, t.slice(URL.length), n].join(" ")); o.prepend(l) } $("#ListStaff").dxDataGrid({ dataSource: ordersStore, repaintChangesOnly: !0, showBorders: !0, hoverStateEnabled: !0, editing: { refreshMode: "full", mode: "popup", allowAdding: !0, allowUpdating: !0, allowDeleting: !0, texts: { confirmDeleteMessage: "Muốn xóa chứ ?", deleteRow: "Xóa", editRow: "Sửa", cancelRowChanges: "Hủy", saveRowChanges: "Lưu" }, popup: { title: "Chỉnh sửa và thêm mới thông tin tài khoản của Staff", showTitle: !0, width: 800, height: 425, position: { my: "top", at: "top", of: window } }, form: { items: [{ itemType: "group", colCount: 2, colSpan: 2, items: ["Img", "ID_AdminUser", "UserName", "FullName", "Acess", "Password", { dataField: "Chú thích", editorType: "dxTextArea", colSpan: 2, editorOptions: { width: 500, height: 100, readOnly: !0, value: "1 => Customer(Khách Hàng), đừng chọn :))\n2 => Admin\n3 => Staff\n4 => Manager" } }] }] } }, columns: [{ dataField: "Img", width: 150, caption: "Ảnh", allowFiltering: !1, allowEditing: !0, cellTemplate: function (e, t) { $("<div>").append($("<img>", { src: "/Content/ImageUploaded/ImageForUser/StaffAvata/" + t.value })).appendTo(e) }, editCellTemplate: function (e, t) { $("<div>").dxFileUploader({ multiple: !0, uploadMode:"useButtons",uploadUrl:UrlUploadImage+"/UploadImageForStaff",allowedFileExtensions:[".jpg",".jpeg",".gif",".png"],name:"UpdateAvata",uploadMethod:"POST",labelText:"hoặc kéo thả!",invalidFileExtensionMessage:"Phải không đúng định dạng!",uploadFailedMessage:"Tải lên thất bại!",uploadButtonText:"Tải lên",uploadedMessage:"Tải lên thành công!",readyToUploadMessage:"Sẵn sàng tải lên!",selectButtonText:"Chọn file",onValueChanged:function(e){$.each(e.value,function(e,a){t.setValue(a.name)})}}).appendTo(e)}},{dataField:"ID_AdminUser",caption:"Mã Staff",allowEditing:!1,headerFilter:{groupInterval:1e4}},{dataField:"UserName",caption:"Tên đăng Nhập",validationRules:[{type:"custom",validationCallback:validateAccountExist}]},{dataField:"FullName",caption:"Họ và tên",validationRules:[{type:"required"}]},{dataField:"Acess",caption:"Quyền",lookup:{dataSource:new DevExpress.data.CustomStore({key:"IdRole",loadMode:"raw",load:function(){return sendRequest(Url+"/RolesLookUp")}}),valueExpr:"IdRole",displayExpr:"Name",paginate:!0}},{dataField:"Password",caption:"Mật khẩu",validationRules:[{type:"required"},{type:"pattern",pattern:"^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})",message:"Sai format mật khẩu!"}]}],summary:{totalItems:[{column:"ID_AdminUser",summaryType:"count"}]}}).dxDataGrid("instance");