let $ = jQuery.noConflict();
let UrlProduct = window.location.origin + "/AdminBCDH/ProcessWithProduct";
let UrlUploadImage = window.location.origin + "/Upload";
let Url = window.location.origin + "/AdminBCDH/ProcessWithImageProduct";

var ordersStoreImage = new DevExpress.data.CustomStore({
    key: "ID_ImageForProduct",
    load: function () {
        return sendRequest(Url + "/GetImageForProduct", "GET");
    },
    insert: function (values) {
        return sendRequest(Url + "/AddProduct", "POST", {
            values: JSON.stringify(values)
        });
    },
    update: function (key, values) {
        return sendRequest(Url + "/EditProduct", "POST", {
            key: key,
            values: JSON.stringify(values)
        });
    },
    remove: function (key) {
        return sendRequest(Url + "/RemoveProduct", "POST", {
            key: key
        });
    }
});

function sendRequest(url, method, data) {
    var d = $.Deferred();
    method = method || "GET";
    $.ajax(url, {
        method: method || "GET",
        data: data,
        cache: false,

        xhrFields: { withCredentials: true }
    }).done(function (result) {
        d.resolve(method === "GET" ? result.data : result);
    }).fail(function (xhr) {
        d.reject(xhr.responseJSON ? xhr.responseJSON.Message : xhr.statusText);
    });
    return d.promise();
}
$("#ImageProduct").dxDataGrid({
    dataSource: ordersStore,
    repaintChangesOnly: true,
    showBorders: true,
    columnAutoWidth: true,
    selection: {
        mode: "single"
    },
    onSelectionChanged: function (e) {
        e.component.collapseAll(-1);
        e.component.expandRow(e.currentSelectedRowKeys[0]);
    },
    editing: {
        refreshMode: "full",
        mode: "popup",
        allowAdding: true,
        allowUpdating: true,
        allowDeleting: true,
        texts: {
            confirmDeleteMessage: "Muốn xóa chứ ?",
            deleteRow: "Xóa",
            editRow: "Sửa",
            cancelRowChanges: "Hủy",
            saveRowChanges: "Lưu"

        },
        popup: {
            title: "Chỉnh sửa và thêm mới danh mục sản phẩm",
            showTitle: true,
            width: 1100,
            height: 600,
            position: {
                my: "top",
                at: "top",
                of: window
            }
        },
        form: {
            items: [{
                itemType: "group",
                colCount: 2,
                colSpan: 2,
                items: ["ID_Product", "ID_Category", "Name_Product", "Quantity", "Price", "Description", "Status", "Sale", "NewArrival", "BestSale"]
            },
            {
                itemType: "group",
                colCount: 2,
                colSpan: 2,
                caption: "Chú Ý Nên Đọc!",
                items: [{
                    dataField: "Chú thích",
                    editorType: "dxTextArea",
                    colSpan: 2,
                    editorOptions: {
                        width: 700,
                        height: 130,
                        readOnly: true,
                        value: "1. Muốn tạo một  sản phẩm mới , thì nhưng chỗ có * đỏ là cần thiết phải có. Mã sản phẩm không được trùng nhau" + "\n" + "2. Phải chọn sản phẩm thuộc danh mục sản phẩm nào !" + "\n" + "3. Các phần còn lại thì điền đủ và đúng là được!" + "\n" + "4.Giá thì điền số,sale cũng thế,nếu không sale thì điền 0 vào nhé "
                    }
                }
                ]
            }

            ]
        }
    },
    scrolling: {
        mode: "virtual"
    },
    columnsAutoWidth: true,
    showBorders: true,
    filterRow: {
        visible: true,
        applyFilter: "auto"
    },
    searchPanel: {
        visible: true,
        width: 240,
        placeholder: "Tìm kiếm..."
    },
    headerFilter: {
        visible: true
    },
    columns: [
        {

            dataField: "ID_Product",
            caption: "Mã sản phẩm",
        },
        {

            dataField: "ID_ImageForProduct",
            caption: "Mã ảnh sản phẩm",
        },
        {

            dataField: "IMG1",
            caption: "Ảnh1",
        },
        {

            dataField: "IMG2",
            caption: "Ảnh2",
        },
        {

            dataField: "IMG3",
            caption: "Ảnh3",
        }, {

            dataField: "IMG4",
            caption: "Ảnh4",
        }
    ]
}).dxDataGrid("instance");